package com.concordium.sdk.queries;

import com.concordium.sdk.responses.accountinfo.AccountInfo;
import com.concordium.sdk.responses.accountinfo.credential.CredentialType;
import com.concordium.sdk.types.AccountAddress;
import com.concordium.sdk.types.Nonce;
import org.junit.Test;

import static org.junit.Assert.assertEquals;

public class AccountInfoTest {

    private static final String NORMAL_ACCOUNT = "{\"accountNonce\":1,\"accountAmount\":\"6491901100476745\",\"accountReleaseSchedule\":{\"total\":\"0\",\"schedule\":[]},\"accountCredentials\":{\"0\":{\"v\":0,\"value\":{\"contents\":{\"arData\":{\"1\":{\"encIdCredPubShare\":\"983494cc4c2ab98fe7ebc46d50dccf1931c3cd2e6b6d7b7893c9cf6a219d6d3bfa34081b2c98b28437858aa0f1acfeb28f4b760539681de1f0c361c3cd2015cf41c789c4878605344635059d4aee7a18cde57b3e2fb8fa9d0651d81ab8c3b483\"},\"2\":{\"encIdCredPubShare\":\"8897b4ff71b734933c33f7335cb4621ae04e64d49f1e9e93d55ce927d784062f923fd05d20cabeff1b2c7545d3ea5a3982ee0e10fac4577e261184a03ff3ce81584793cccfa9aa7e44eaf03629c9620b65e467cbf7f1cd819c20f7e737910197\"},\"3\":{\"encIdCredPubShare\":\"93b4800087a0436170816dc44524db13c725237e075ea81dafe246eb8c000a7db7d54e92dc1b36f6f99f459b70c45807b368b4fbe5e3c6e605dcb86831bfc17d7d29854d7566e9aa26a519babab8e57d0de55ded296cce4422d9849d236b260d\"}},\"commitments\":{\"cmmAttributes\":{},\"cmmCredCounter\":\"8591edaeea0ff975d5c29df754d7f036899f80bffcb039a643e5f6fc74030ac67eaf364d5c7ac17ffd7315959b4026e3\",\"cmmIdCredSecSharingCoeff\":[\"95818b92e5b7b840bac34bfd14258c53a5dfb0ce0e9c97940853bcebae4128b9d7e00aa7d1d100e0fdae344da5d5b20b\",\"936018384d4354dd90b5f993e939a1088f968e51e71de3861146b35302e66134bb2c9cf1733869eca923aa1f0d5ca212\"],\"cmmMaxAccounts\":\"8da7f0dd3e4b02b7d03d1d577334f4e1126607f9ad096b4c8f95caafe442a1067f3c5ed556f76063e0efb00c6f6ef638\",\"cmmPrf\":\"b0ad110899b52c001e27c6907f6d1af740b481d78889597141319e9abf8c6b4d699acfa54ac0d30f2e355b965916cad4\"},\"credId\":\"995cd68b3fd17b43a9fb4e05da09d9922932667a2e42580075d9f9aca006b69e186c4370096eaf8fd3e5bb49f59b263d\",\"credentialPublicKeys\":{\"keys\":{\"0\":{\"schemeId\":\"Ed25519\",\"verifyKey\":\"d8755ef010d0e556b18e9b0ca5b1b2e244be63b505dde117f8b94592f7d66f4a\"}},\"threshold\":1},\"ipIdentity\":0,\"policy\":{\"createdAt\":\"202307\",\"revealedAttributes\":{},\"validTo\":\"202807\"},\"revocationThreshold\":1},\"type\":\"normal\"}}},\"accountThreshold\":1,\"accountEncryptedAmount\":{\"incomingAmounts\":[],\"selfAmount\":\"c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\",\"startIndex\":0},\"accountEncryptionKey\":\"b14cbfe44a02c6b1f78711176d5f437295367aa4f2a8c2551ee10d25a03adc69d61a332a058971919dad7312e1fc94c5995cd68b3fd17b43a9fb4e05da09d9922932667a2e42580075d9f9aca006b69e186c4370096eaf8fd3e5bb49f59b263d\",\"accountIndex\":1,\"accountAddress\":\"4HeFCY84KJpZz6AUAFkKfk4ktV6sghX9UVh5MVqfb8TFSGr3MU\",\"accountBaker\":{\"bakerAggregationVerifyKey\":\"90097744501a5d4fcdaee001c435b221e85c8afaf22124f0399b9556e864dd7746914d24f05bc64ca0f998bdde0d5cc809a6bb57c75cd3fb1b4847792e79062c62f07fb62b8bca94a883527968e4231d05cf7606f910850d89c6d49452f143eb\",\"bakerElectionVerifyKey\":\"66672c1d0dcdd1e6186c18b9516823a7abb62c8b80ae0b2811db4d6087d2cc65\",\"bakerId\":1,\"bakerPoolInfo\":{\"commissionRates\":{\"bakingCommission\":1.0,\"finalizationCommission\":0.1,\"transactionCommission\":1.0},\"metadataUrl\":\"\",\"openStatus\":\"openForAll\"},\"bakerSignatureVerifyKey\":\"7d46410f28a48d7596460f6759e2b49c2a7a54ec81df326d00416b33328e4e10\",\"restakeEarnings\":false,\"stakedAmount\":\"1000000000000000\"}}\n";
    private static final String INITIALI_ACCOUNT = "{\"accountNonce\":3,\"accountAmount\":\"19999317365\",\"accountReleaseSchedule\":{\"total\":\"0\",\"schedule\":[]},\"accountCredentials\":{\"0\":{\"v\":0,\"value\":{\"contents\":{\"credentialPublicKeys\":{\"keys\":{\"0\":{\"schemeId\":\"Ed25519\",\"verifyKey\":\"fea507e53a6cf34bc952dc6db1a9a35a53e746daa62ef8b8fbfe8dd825f5559e\"}},\"threshold\":1},\"ipIdentity\":0,\"policy\":{\"createdAt\":\"202307\",\"revealedAttributes\":{},\"validTo\":\"202407\"},\"regId\":\"8021f898d984228ee6868a377b49b3e67ddde0639eed4e59d49cec081c3afc49ef2fc757332a65535453dd0f12d9a333\"},\"type\":\"initial\"}}},\"accountThreshold\":1,\"accountEncryptedAmount\":{\"incomingAmounts\":[],\"selfAmount\":\"c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\",\"startIndex\":0},\"accountEncryptionKey\":\"b14cbfe44a02c6b1f78711176d5f437295367aa4f2a8c2551ee10d25a03adc69d61a332a058971919dad7312e1fc94c58021f898d984228ee6868a377b49b3e67ddde0639eed4e59d49cec081c3afc49ef2fc757332a65535453dd0f12d9a333\",\"accountIndex\":156,\"accountAddress\":\"3hk5D6yZaAebRmX6RYy46Lbd9BzQLXwoHLass4cXQoAdUGSSmz\"}\n";

    @Test
    public void testDeserializeAccountInfo() {
        AccountInfo accountInfo = AccountInfo.fromJson(NORMAL_ACCOUNT);
        assertEquals(AccountAddress.from("4HeFCY84KJpZz6AUAFkKfk4ktV6sghX9UVh5MVqfb8TFSGr3MU"), accountInfo.getAccountAddress());
        assertEquals(Nonce.from(1), accountInfo.getAccountNonce());
        assertEquals(CredentialType.NORMAL, accountInfo.getAccountCredentials().values().iterator().next().getType());

        AccountInfo accountInfo2 = AccountInfo.fromJson(INITIALI_ACCOUNT);
        assertEquals(AccountAddress.from("3hk5D6yZaAebRmX6RYy46Lbd9BzQLXwoHLass4cXQoAdUGSSmz"), accountInfo2.getAccountAddress());
        assertEquals(Nonce.from(3), accountInfo2.getAccountNonce());
        assertEquals(CredentialType.INITIAL, accountInfo2.getAccountCredentials().values().iterator().next().getType());
    }

}
